<!-- SHOW BANNER -->
<% if @spot.photo %>
  <% img_url = cl_image_path @spot.photo.path, :width => 1600, :height => 700, :crop => :fill,
             :gravity => :south %>
<% else %>
  <% img_url = "http://res.cloudinary.com/dmx5zou5e/image/upload/c_crop,g_custom,h_700,w_1600,x_922,y_559/v1480531988/image1_henvzi.jpg"%>
<% end %>
<div class="banner banner-show" style="background-image: linear-gradient(rgba(201, 255, 191, 0.2), rgba(255, 175, 189, 0.2)),
         url('<%= img_url %>')">
  <h1 id="spot-show-h1-title"><%= @spot.name.capitalize %>
    <% if @spot.average_rating %>
      <div id="spot-rating">
        <% @spot.average_rating.round.times do %>
          <i class="fa fa-star yellow-filled"></i>
        <% end %>
        <% (5 - @spot.average_rating.round).times do %>
          <i class="fa fa-star-o"></i>
        <% end %>
      </div>
    <% end %>
    <%= link_to favorite_spots_path(spot_id: params[:id]), method: :post, id: "add-to-favorite-btn", class: "kite-round-btn" do %>
      <i class="fa fa-heart"></i>
    <% end %>
  </h1>

  <div class="tabs">
    <a class="tab active" href="#" id="tab_weather">
      <p>WEATHER</p>
    </a>
    <a class="tab" href="#" id="tab_infos">
      <p>INFOS</p>
    </a>
    <a class="tab" href="#" id="tab_reviews">
      <p>REVIEWS</p>
    </a>
  </div>
</div>

<div class="wrapper">
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <!-- Content for Weather section -->
        <div class="content" id="content_for_weather">
          <!-- Weather infos -->
          <div class="col-xs-12">
            <div class="summary text-center">
              <div class="info-spot">
                <div class="info-spot-items" id="temperature">
                  <h1><%= @spot.fresh_forecasts.first.temperature.round %> °C</h1>
                  <p id="hour"><%= (Time.now + 60*60).strftime("%H:%M") %></p>
                </div>
                <div class="info-spot-items">
                  <% condition = @spot.fresh_forecasts.first.icon %>
                  <%= image_tag @condition_icons[condition] %>
                  <%= @condition_string[condition] %>
                </div>
                <div class="info-spot-items">
                  <% @humidity = @spot.fresh_forecasts.first.cloud_cover*100 %>
                  <%= @humidity.round %>%
                  <p>Humidity</p>
                </div>
                <div class="info-spot-items text-center">
                  <%= image_tag "wind.svg", id: "strength" %> <br>
                  <%= @spot.fresh_forecasts.first.wind_strength.round %> kt
                </div>
                <div class="info-spot-items">
                  <% w = @spot.fresh_forecasts.first.wind_direction%>
                  <div style="transform: rotate(<%= w + 180 %>deg)"> <%= image_tag "wind_direction.svg" %></div>
                  <%= @spot.find_string_direction(w) %>
                </div>
                  <!-- ATTENTION à modifier selon le spot.fresh_forecasts.first.icon -->
              </div>
            </div>

            <!-- Feedback infos -->
            <div class="feedbacks-content">
              <div class="section-title">
                <h2>Real time feedbacks</h2>
              </div>
              <%= render 'weather_feedbacks', feedbacks: @spot.weather_feedbacks %>
              <div class="add-review-button text-center">
                <% if user_signed_in? %>
                  <button class="kite-std-btn" type="button" data-toggle="modal" data-target="#myModal">
                    Give a real time feedback
                  </button>
                <% else %>
                  <%= link_to "Add a review", new_user_session_path, class: "kite-std-btn"%>
                <% end %>
              </div>
            </div>

            <!-- Weather forecasts -->
            <div class="section-title orange-underlining">
              <a href="" id="weather_forecasts_link"><h2>Weather forecasts</h2></a>
            </div>
            <div class="arrow">
              <%= image_tag "orange-triangle.svg" %>
            </div>
            <div id="weather_forecasts_content" class="margin-29 hidden">
              <%= render 'forecast', forecasts: nil %>
            </div>
            <!-- Tide infos -->
            <div class="section-title">
              <a href="" id="tide_forecasts_link"><h2>Tide forecasts</h2></a>
            </div>
            <div id="tide_forecasts_content" class="margin-29 hidden">
              <div class="tide-data hidden">
                <% query = @spot.harbor.query if @spot.harbor %>
                <% query = "ABER_BENOIT_MEAN_RENEAT" if !@spot.harbor #TEST PURPOSES, line to be delted%>
                <script src="http://services.data.shom.fr/hdm/vignette/petite/<%= query %>?locale=fr"></script>
              </div>
            </div>
          <!-- End of content for Weather section -->
          </div>

      </div>

        <!-- Content for Infos section -->
        <div class="content hidden" id="content_for_infos">
          <!-- Title Section -->
          <div class="col-xs-12">
            <div class="section-title">
              <h2>Description</h2>
            </div>
            <p class="margin-29"><%= @spot.description unless @spot.description.nil?%></p>
          </div>
          <!-- Facilities -->
          <div class="col-xs-12">
            <div class="section-title">
              <h2>Facilities</h2>
            </div>
            <% unless @spot.facility.nil? %>
              <% unless @spot.facility[:parking].nil? %><p><strong>Parking:</strong> <%= @spot.facility[:parking] %></p><% end %>
              <% unless @spot.facility[:safety_watch].nil? %><p><strong>Sécurité: <%= @spot.facility[:safety_watch] %></p><% end %></strong>
              <% unless @spot.facility[:kite_school].nil? %><p><strong>Ecoles:</strong> <%= @spot.facility[:kite_school] %></p><% end %>
              <% unless @spot.facility[:water_spot].nil? %><p><strong>Point d'eau:</strong> <%= @spot.facility[:water_spot] %></p><% end %>
              <% unless @spot.facility[:shop].nil? %><p><strong>Shop:</strong> <%= @spot.facility[:shop] %></p><% end %>
              <% unless @spot.facility[:shower].nil? %><p><strong>Douches:</strong> <%= @spot.facility[:shower] %></p><% end %>
              <% unless @spot.facility[:comment].nil? %><p><strong>Commentaires:</strong> <%= @spot.facility[:comment] %></p><% end %>
            <% else %>
              <p>No facilities added for this spot</p>
            <% end %>
          </div>
        </div>
        <!-- End of content for Infos section -->

        <!-- Content for Reviews section -->
        <div class="content hidden" id="content_for_reviews">
          <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="section-title">
              <%= render "spots/reviews_count", spot: @spot %>
            </div>
            <!-- Modal for reviews -->
            <!-- btn btn-primary btn-lg -->
            <% if user_signed_in? %>
              <button type="button" class="kite-std-btn comment-button" data-toggle="modal" data-target="#myModalReview">
                Add a review
              </button>
            <% else %>
              <%= link_to "Sign in and had a review", new_user_session_path, class: "kite-std-btn"%>
            <% end %>
            <hr>
            <div class="spot-show-card" id="reviews">
              <% @spot.reviews.each do |review| %>
               <%= render 'reviews/show', review: review %>
              <% end %>
            </div>
          </div>
        </div>
        <!-- End of content for Reviews section -->

        <!-- Review Modal -->
          <div class="modal fade" id="myModalReview" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title" id="myModalLabel">Review</h4>
                </div>
                <div class="modal-body" id="review_form_container">
                  <%= render 'reviews/form', spot: @spot, review: @review %>
                </div>
                <div class="modal-footer">
                  <button type="button" class="kite-std-btn" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

           <!-- Weather feedbacks Modal -->
          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title" id="myModalLabel">Weather feedback</h4>
                </div>
                <div class="modal-body" id="forecast_form_container">
                  <%= render 'weather_feedbacks/form', spot: @spot, feedback: @feedback %>
                </div>
                <div class="modal-footer">
                  <button type="button" class="kite-std-btn" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
        <!-- End of features -->
      </div>
    </div>
  </div>
</div>

